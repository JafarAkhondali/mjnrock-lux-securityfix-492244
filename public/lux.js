import{GenerateUUID}from"./../core/helper";export default class Event{constructor(t,e,r=null){return this._uuid=GenerateUUID(),this._type=t,this._payload=e,this._emitters=r?[r]:[],Object.freeze(this)}UUID(){return this._uuid}getType(){return this._type}isType(t){return this._type===t}getPayload(){if("prop-change"===this._type)try{return this._payload[0]}catch(t){throw new Error('[Non-Conventional Payload]: A "prop-change" event must conform its payload to the standard shape')}return this._payload}getEmitter(t=0){return this._emitters[t]}addEmitter(t){return this._emitters.push(t),this}getEmitters(){return this._emitters}};
import{GenerateUUID}from"./../core/helper";export default class Listener{constructor(e,t){if(this._uuid=GenerateUUID(),this._event=e,this._callback=t,null===e||void 0===e)throw new Error("[Invalid Event]: Event cannot be empty");if("function"!=typeof t)throw new Error("[Invalid Callback]: Callback must be a function");return Object.freeze(this)}UUID(){return this._uuid}getEvent(){return this._event}getCallback(){return this._callback}runCallback(e){return this._callback(e)}};
import fetch from"node-fetch";import{GenerateUUID}from"./../core/helper";import Subscription from"./Subscription";import Event from"./Event";import Listener from"./Listener";import Watcher from"./Watcher";export default class Node{constructor(){this._id=null,this._uuid=GenerateUUID(),this._modules=[],this._meta={},this._registerModule("meta"),this._events={error:t=>t,"prop-change":t=>t},this._listeners={},this._subscribers={},this._watchers={},this._next=null,this._registerModule("events"),this._state={},this._registerModule("state"),this._children={},this._parent=null,this._registerModule("progeny")}_registerModule(t){return this._modules.includes(t)||this._modules.push(t),this}_hasModule(t){return this._modules.includes(t)}ID(t=null){return null!==t&&void 0!==t?(this._id=t,this):this._id}UUID(t=null){if(!0===t)this._uuid=GenerateUUID();else{if(null===t||void 0===t)return this._uuid;if(!new RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/,"i").test(t))throw new Error("[Invalid UUID]: @uuid is did not pass a UUID RegEx check.  Invoke 'this.UUID(true)' to auto-generate.");this._uuid=t}return this}setMeta(t={}){return this._meta=t,this}getMeta(){return this._meta}meta(t,e){return void 0===e?this.getMeta(t):this.setMeta(t,e)}hasEvent(t){return t in this._events}addEvent(...t){for(let e of t)("string"==typeof e||e instanceof String)&&(this._events[e]=null);return this}on(t,e){return"function"!=typeof e&&(e=null),this._events[t]=e,this}off(t){return delete this._events[t],this}emit(t,...e){let r;if(t instanceof Event?(t=(r=t).getType(),r.addEmitter(this)):("string"==typeof t||t instanceof String)&&(r=new Event(t,e,this)),!(t in this._events))throw new Error(`[Invalid Event]: "${t}" has not been registered`);return"function"==typeof this._events[t]&&this._events[t](r),(async e=>{for(let s in e._listeners[t]){let i=e._listeners[t][s];i instanceof Listener?i.runCallback(r,i):e.emit("error","Listener<"+t+"> has no method")}if("prop-change"===t&&r instanceof Event){let{prop:t}=r.getPayload();for(let s in e._watchers[t]){let i=e._watchers[t][s];i instanceof Watcher?i.runCallback(r,i):e.emit("error","Listener<"+t+"> has no method")}}for(let t in e._subscribers){let s=e._subscribers[t].getSubscribor();"function"==typeof s._next&&s.next(r,s)}})(this),this}listen(t,e){Array.isArray(this._listeners[t])||(this._listeners[t]=[]);let r=new Listener(t,e);return this._listeners[t].push(r),r}unlisten(t){if(t instanceof Listener){let e=this._listeners[t.getEvent()].findIndex(e=>e.UUID()===t.UUID());return e>-1&&this._listeners[t.getEvent()].splice(e,1),!0}return!1}getNext(){return this._next}setNext(t){return"function"==typeof t&&(this._next=t),this}next(t){if("function"==typeof this._next)return this._next(t)}subscribe(t){if(t instanceof Node){let e=new Subscription(t,this);return this._subscribers[e.UUID()]=e,e}return!1}unsubscribe(t){return t instanceof Subscription&&delete this._subscribers[t.UUID()],!1}watch(t,e){if(Array.isArray(t)){let r={};return t.forEach(t=>{Array.isArray(this._watchers[t])||(this._watchers[t]=[]);let s=new Watcher(t,e);this._watchers[t].push(s),Array.isArray(r[t])||(r[t]=[]),r[t].push(s)}),r}{Array.isArray(this._watchers[t])||(this._watchers[t]=[]);let r=new Watcher(t,e);return this._watchers[t].push(r),r}}unwatch(t){if(t instanceof Watcher){let e=this._watchers[t.getProp()].findIndex(e=>e.UUID()===t.UUID());return e>-1&&this._watchers[t.getProp()].splice(e,1),!0}return!1}setState(t={}){return this._state=t,this}getState(){return this}setProp(t,e){let r=this._state[t];return this._state[t]=e,this.emit("prop-change",{prop:t,previous:r,current:e}),this}getProp(t){return this._state[t]}prop(t,e){return void 0!==e?this.setProp(t,e):this.getProp(t)}aprop(t,e,r){if(void 0!==e){if(void 0!==r){let s=this.getProp(t);return s[+e]=r,this.setProp(t,s)}return this.getProp(t)[+e]}return this.getProp(t)}oprop(t,e,r){if(void 0!==e){let s=this.getProp(t),i=this.getProp(t),n=e.split("."),h=n.length;for(let t=0;t<h-1;t++){let e=n[t];i[e]||(i[e]={}),i=i[e]}return void 0!==r?(i[n[h-1]]=r,this.setProp(t,s)):i}return this.getProp(t)}$prop(t,e,{reducer:r=null,opts:s={method:"GET",mode:"cors"},jsonResponse:i=!0}={}){fetch(e,s).then(t=>t[i?json:blob]()).then(e=>{let s;if(void 0===e)return!1;s="function"==typeof r?r(e):e,this.setProp(t,s)})}async $propPost(t,e){return await(async(t,e)=>{let r=await fetch(e,{method:"POST",mode:"cors",body:JSON.stringify(this.getProp(t))});return await r})(t,e)}adopt(t){return t instanceof Node&&(this._children[t.UUID()]=t,this.subscribe(t),t.setParent(this)),this}abandon(t){return t instanceof Node?(delete this._children[child.UUID()],this.unsubscribe(t),child.setParent(null)):("string"==typeof t||t instanceof String)&&(delete this._children[t],this.unsubscribe(t)),this}getChild(t){return this._children[t]}setChild(t,e){return this._children[t]=e,this}getParent(){return this._parent}setParent(t){return this._parent=t,this}child(t,e){return void 0===e?this.getChild(t):this.setChild(t,e)}parent(t){return void 0===t?this.getParent():this.setParent(t)}};
import Event from"./Event";import Subscription from"./Subscription";import Listener from"./Listener";import Watcher from"./Watcher";import Node from"./Node";export default{Event:Event,Subscription:Subscription,Listener:Listener,Watcher:Watcher,Node:Node};
import{GenerateUUID}from"./../core/helper";export default class Subscription{constructor(r,e){return this._uuid=GenerateUUID(),this._subscribor=r,this._subscribee=e,Object.freeze(this)}UUID(){return this._uuid}getSubscribor(){return this._subscribor}getSubscribee(){return this._subscribee}isSubscribor(r,e=-1){if(-1===e&&("string"==typeof r||r instanceof String)){let e=this._subscribor._uuid||!1;if(e)return e===r}else if("function"==typeof e)return!0===e(r);return!1}isSubscribee(r,e=-1){if(-1===e&&("string"==typeof r||r instanceof String)){let e=this._subscribee._uuid||!1;if(e)return e===r}else if("function"==typeof e)return!0===e(r);return!1}};
import{GenerateUUID}from"../core/helper";export default class Watcher{constructor(r,t){if(this._uuid=GenerateUUID(),this._prop=r,this._callback=t,null===r||void 0===r)throw new Error("[Invalid Prop]: Prop cannot be empty");if("function"!=typeof t)throw new Error("[Invalid Callback]: Callback must be a function");return Object.freeze(this)}UUID(){return this._uuid}getProp(){return this._prop}getCallback(){return this._callback}runCallback(...r){return this._callback(...r)}};